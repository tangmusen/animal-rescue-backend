<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>动物救助后端管理系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #333;
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .api-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: #e8f5e9;
            border-radius: 25px;
            color: #2e7d32;
            font-weight: 600;
        }

        .api-status.offline {
            background: #ffebee;
            color: #c62828;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #4caf50;
            animation: pulse 2s infinite;
        }

        .status-dot.offline {
            background: #f44336;
            animation: none;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(76, 175, 80, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
        }

        .tabs {
            background: white;
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            display: flex;
            gap: 10px;
        }

        .tab-btn {
            padding: 12px 24px;
            border: none;
            background: #f5f5f5;
            color: #666;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            background: #e0e0e0;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .content-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: none;
        }

        .content-card.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 20px;
            border-radius: 10px;
            color: white;
        }

        .stat-card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #666;
            border-bottom: 2px solid #e0e0e0;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            margin-right: 5px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-success {
            background: #4caf50;
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .search-box {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            width: 300px;
            font-size: 14px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-btn {
            font-size: 28px;
            cursor: pointer;
            color: #999;
            border: none;
            background: none;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .json-viewer {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .tag {
            display: inline-block;
            padding: 4px 8px;
            background: #e3f2fd;
            color: #1976d2;
            border-radius: 4px;
            font-size: 12px;
            margin-right: 4px;
        }

        .tag.emergency {
            background: #ffebee;
            color: #c62828;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .empty-state {
            text-align: center;
            padding: 60px;
            color: #999;
        }

        .empty-state h3 {
            color: #666;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🐾 动物救助后端管理系统</h1>
            <div class="api-status" id="apiStatus">
                <span class="status-dot"></span>
                <span>API服务运行中</span>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('overview')">📊 总览</button>
            <button class="tab-btn" onclick="switchTab('forum')">💬 论坛管理</button>
            <button class="tab-btn" onclick="switchTab('profiles')">📁 档案管理</button>
            <button class="tab-btn" onclick="switchTab('data')">💾 数据管理</button>
            <button class="tab-btn" onclick="switchTab('api-test')">🔧 API测试</button>
        </div>

        <!-- 总览面板 -->
        <div id="overview" class="content-card active">
            <h2>系统总览</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>论坛帖子</h3>
                    <div class="value" id="postsCount">0</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                    <h3>动物档案</h3>
                    <div class="value" id="profilesCount">0</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);">
                    <h3>今日访问</h3>
                    <div class="value" id="visitsCount">0</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                    <h3>API调用</h3>
                    <div class="value" id="apiCallsCount">0</div>
                </div>
            </div>
            
            <h3>最近活动</h3>
            <div id="recentActivity" class="data-table">
                <div class="loading">加载中...</div>
            </div>
        </div>

        <!-- 论坛管理面板 -->
        <div id="forum" class="content-card">
            <div class="action-bar">
                <h2>论坛帖子管理</h2>
                <div>
                    <input type="text" class="search-box" placeholder="搜索帖子..." onkeyup="searchPosts(this.value)">
                    <button class="btn btn-success" onclick="showAddPostModal()">+ 添加帖子</button>
                </div>
            </div>
            
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>标题</th>
                        <th>作者</th>
                        <th>标签</th>
                        <th>点赞</th>
                        <th>评论</th>
                        <th>时间</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="postsTable">
                    <tr><td colspan="8" class="loading">加载中...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- 档案管理面板 -->
        <div id="profiles" class="content-card">
            <div class="action-bar">
                <h2>动物档案管理</h2>
                <div>
                    <input type="text" class="search-box" placeholder="搜索档案..." onkeyup="searchProfiles(this.value)">
                    <button class="btn btn-success" onclick="showAddProfileModal()">+ 添加档案</button>
                </div>
            </div>
            
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>名字</th>
                        <th>类型</th>
                        <th>品种</th>
                        <th>状态</th>
                        <th>救助地点</th>
                        <th>救助日期</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="profilesTable">
                    <tr><td colspan="8" class="loading">加载中...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- 数据管理面板 -->
        <div id="data" class="content-card">
            <h2>数据管理</h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                <div>
                    <h3>导出数据</h3>
                    <p style="color: #666; margin: 10px 0;">导出所有数据为JSON格式</p>
                    <button class="btn btn-primary" onclick="exportData()">📥 导出所有数据</button>
                </div>
                
                <div>
                    <h3>导入数据</h3>
                    <p style="color: #666; margin: 10px 0;">从JSON文件导入数据</p>
                    <input type="file" id="importFile" accept=".json" style="margin-bottom: 10px;">
                    <button class="btn btn-primary" onclick="importData()">📤 导入数据</button>
                </div>
            </div>
            
            <div style="margin-top: 30px;">
                <h3>数据预览</h3>
                <div id="dataPreview" class="json-viewer">
                    点击导出按钮查看数据
                </div>
            </div>
        </div>

        <!-- API测试面板 -->
        <div id="api-test" class="content-card">
            <h2>API测试工具</h2>
            
            <div class="form-group">
                <label>选择API</label>
                <select id="apiEndpoint" onchange="updateApiTest()">
                    <option value="/api/forum">论坛 - GET /api/forum</option>
                    <option value="/api/profiles">档案 - GET /api/profiles</option>
                    <option value="/api/location">定位 - POST /api/location</option>
                    <option value="/api/upload">上传 - POST /api/upload</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>请求方法</label>
                <select id="apiMethod">
                    <option value="GET">GET</option>
                    <option value="POST">POST</option>
                    <option value="PUT">PUT</option>
                    <option value="DELETE">DELETE</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>请求参数 (JSON)</label>
                <textarea id="apiParams" placeholder='{"page": 1, "limit": 10}'>{}</textarea>
            </div>
            
            <button class="btn btn-primary" onclick="testApi()">发送请求</button>
            
            <div style="margin-top: 20px;">
                <h3>响应结果</h3>
                <div id="apiResponse" class="json-viewer">
                    还未发送请求
                </div>
            </div>
        </div>
    </div>

    <!-- 模态框 -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">编辑</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody">
                <!-- 动态内容 -->
            </div>
        </div>
    </div>

    <script>
        // 配置
        const API_BASE = window.location.origin;
        let currentTab = 'overview';
        let allPosts = [];
        let allProfiles = [];
        let apiCalls = 0;

        // 初始化
        window.onload = function() {
            checkApiStatus();
            loadOverview();
            setInterval(checkApiStatus, 30000); // 每30秒检查一次
        };

        // 检查API状态
        async function checkApiStatus() {
            try {
                const response = await fetch(`${API_BASE}/api/forum`);
                if (response.ok) {
                    document.getElementById('apiStatus').className = 'api-status';
                    document.getElementById('apiStatus').innerHTML = 
                        '<span class="status-dot"></span><span>API服务运行中</span>';
                }
            } catch (error) {
                document.getElementById('apiStatus').className = 'api-status offline';
                document.getElementById('apiStatus').innerHTML = 
                    '<span class="status-dot offline"></span><span>API服务离线</span>';
            }
        }

        // 切换标签
        function switchTab(tab) {
            currentTab = tab;
            
            // 更新标签按钮
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // 更新内容
            document.querySelectorAll('.content-card').forEach(card => {
                card.classList.remove('active');
            });
            document.getElementById(tab).classList.add('active');
            
            // 加载对应数据
            switch(tab) {
                case 'overview':
                    loadOverview();
                    break;
                case 'forum':
                    loadPosts();
                    break;
                case 'profiles':
                    loadProfiles();
                    break;
            }
        }

        // 加载总览
        async function loadOverview() {
            try {
                // 获取论坛帖子数
                const postsRes = await fetch(`${API_BASE}/api/forum`);
                const postsData = await postsRes.json();
                document.getElementById('postsCount').textContent = 
                    postsData.data?.pagination?.total || 0;
                
                // 获取档案数
                const profilesRes = await fetch(`${API_BASE}/api/profiles`);
                const profilesData = await profilesRes.json();
                document.getElementById('profilesCount').textContent = 
                    profilesData.data?.pagination?.total || 0;
                
                // 模拟其他数据
                document.getElementById('visitsCount').textContent = 
                    Math.floor(Math.random() * 100 + 50);
                document.getElementById('apiCallsCount').textContent = ++apiCalls;
                
                // 最近活动
                const recentHtml = `
                    <table class="data-table">
                        <tr>
                            <td>🆕 新增帖子</td>
                            <td>紧急救助！发现受伤小猫</td>
                            <td>刚刚</td>
                        </tr>
                        <tr>
                            <td>📝 更新档案</td>
                            <td>小橘 - 状态更新为已领养</td>
                            <td>5分钟前</td>
                        </tr>
                        <tr>
                            <td>👍 点赞</td>
                            <td>用户点赞了"寻找橘猫主人"</td>
                            <td>10分钟前</td>
                        </tr>
                    </table>
                `;
                document.getElementById('recentActivity').innerHTML = recentHtml;
                
            } catch (error) {
                console.error('加载总览失败:', error);
            }
        }

        // 加载论坛帖子
        async function loadPosts() {
            try {
                const response = await fetch(`${API_BASE}/api/forum?limit=100`);
                const data = await response.json();
                allPosts = data.data?.posts || [];
                renderPosts(allPosts);
                apiCalls++;
            } catch (error) {
                console.error('加载帖子失败:', error);
                document.getElementById('postsTable').innerHTML = 
                    '<tr><td colspan="8" class="empty-state">加载失败</td></tr>';
            }
        }

        // 渲染帖子
        function renderPosts(posts) {
            if (posts.length === 0) {
                document.getElementById('postsTable').innerHTML = 
                    '<tr><td colspan="8" class="empty-state">暂无数据</td></tr>';
                return;
            }
            
            const html = posts.map(post => `
                <tr>
                    <td>${post.id}</td>
                    <td>${post.title}</td>
                    <td>${post.author}</td>
                    <td>
                        ${post.isEmergency ? '<span class="tag emergency">紧急</span>' : ''}
                        ${post.tags?.map(tag => `<span class="tag">${tag}</span>`).join('') || ''}
                    </td>
                    <td>${post.likes}</td>
                    <td>${post.comments}</td>
                    <td>${new Date(post.createTime).toLocaleDateString()}</td>
                    <td>
                        <button class="btn btn-primary" onclick='editPost(${JSON.stringify(post)})'>编辑</button>
                        <button class="btn btn-danger" onclick="deletePost('${post.id}')">删除</button>
                    </td>
                </tr>
            `).join('');
            
            document.getElementById('postsTable').innerHTML = html;
        }

        // 搜索帖子
        function searchPosts(keyword) {
            if (!keyword) {
                renderPosts(allPosts);
                return;
            }
            
            const filtered = allPosts.filter(post => 
                post.title.includes(keyword) || 
                post.content.includes(keyword) ||
                post.author.includes(keyword)
            );
            renderPosts(filtered);
        }

        // 加载档案
        async function loadProfiles() {
            try {
                const response = await fetch(`${API_BASE}/api/profiles?limit=100`);
                const data = await response.json();
                allProfiles = data.data?.profiles || [];
                renderProfiles(allProfiles);
                apiCalls++;
            } catch (error) {
                console.error('加载档案失败:', error);
                document.getElementById('profilesTable').innerHTML = 
                    '<tr><td colspan="8" class="empty-state">加载失败</td></tr>';
            }
        }

        // 渲染档案
        function renderProfiles(profiles) {
            if (profiles.length === 0) {
                document.getElementById('profilesTable').innerHTML = 
                    '<tr><td colspan="8" class="empty-state">暂无数据</td></tr>';
                return;
            }
            
            const html = profiles.map(profile => `
                <tr>
                    <td>${profile.id}</td>
                    <td>${profile.name}</td>
                    <td>${profile.type}</td>
                    <td>${profile.breed}</td>
                    <td>${profile.currentStatus}</td>
                    <td>${profile.rescueLocation}</td>
                    <td>${profile.rescueDate}</td>
                    <td>
                        <button class="btn btn-primary" onclick='editProfile(${JSON.stringify(profile)})'>编辑</button>
                        <button class="btn btn-danger" onclick="deleteProfile('${profile.id}')">删除</button>
                    </td>
                </tr>
            `).join('');
            
            document.getElementById('profilesTable').innerHTML = html;
        }

        // 搜索档案
        function searchProfiles(keyword) {
            if (!keyword) {
                renderProfiles(allProfiles);
                return;
            }
            
            const filtered = allProfiles.filter(profile => 
                profile.name.includes(keyword) || 
                profile.rescueLocation.includes(keyword) ||
                profile.breed.includes(keyword)
            );
            renderProfiles(filtered);
        }

        // 显示添加帖子模态框
        function showAddPostModal() {
            document.getElementById('modalTitle').textContent = '添加新帖子';
            document.getElementById('modalBody').innerHTML = `
                <div class="form-group">
                    <label>标题</label>
                    <input type="text" id="postTitle" placeholder="输入帖子标题">
                </div>
                <div class="form-group">
                    <label>内容</label>
                    <textarea id="postContent" placeholder="输入帖子内容"></textarea>
                </div>
                <div class="form-group">
                    <label>作者</label>
                    <input type="text" id="postAuthor" placeholder="输入作者名称">
                </div>
                <div class="form-group">
                    <label>紧急救助</label>
                    <select id="postEmergency">
                        <option value="false">否</option>
                        <option value="true">是</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>标签（逗号分隔）</label>
                    <input type="text" id="postTags" placeholder="救助,猫,紧急">
                </div>
                <button class="btn btn-success" onclick="savePost()">保存</button>
            `;
            document.getElementById('modal').classList.add('active');
        }

        // 编辑帖子
        function editPost(post) {
            document.getElementById('modalTitle').textContent = '编辑帖子';
            document.getElementById('modalBody').innerHTML = `
                <div class="form-group">
                    <label>ID</label>
                    <input type="text" id="postId" value="${post.id}" readonly>
                </div>
                <div class="form-group">
                    <label>标题</label>
                    <input type="text" id="postTitle" value="${post.title}">
                </div>
                <div class="form-group">
                    <label>内容</label>
                    <textarea id="postContent">${post.content}</textarea>
                </div>
                <div class="form-group">
                    <label>作者</label>
                    <input type="text" id="postAuthor" value="${post.author}">
                </div>
                <div class="form-group">
                    <label>紧急救助</label>
                    <select id="postEmergency">
                        <option value="false" ${!post.isEmergency ? 'selected' : ''}>否</option>
                        <option value="true" ${post.isEmergency ? 'selected' : ''}>是</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>标签（逗号分隔）</label>
                    <input type="text" id="postTags" value="${post.tags?.join(',') || ''}">
                </div>
                <div class="form-group">
                    <label>点赞数</label>
                    <input type="number" id="postLikes" value="${post.likes}">
                </div>
                <button class="btn btn-success" onclick="updatePost()">更新</button>
            `;
            document.getElementById('modal').classList.add('active');
        }

        // 保存帖子
        async function savePost() {
            const postData = {
                title: document.getElementById('postTitle').value,
                content: document.getElementById('postContent').value,
                author: document.getElementById('postAuthor').value,
                isEmergency: document.getElementById('postEmergency').value === 'true',
                tags: document.getElementById('postTags').value.split(',').map(t => t.trim()),
                location: '上海市'
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/forum`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(postData)
                });
                
                if (response.ok) {
                    alert('添加成功！');
                    closeModal();
                    loadPosts();
                } else {
                    alert('添加失败！');
                }
            } catch (error) {
                alert('操作失败：' + error.message);
            }
        }

        // 更新帖子
        async function updatePost() {
            const postData = {
                title: document.getElementById('postTitle').value,
                content: document.getElementById('postContent').value,
                author: document.getElementById('postAuthor').value,
                isEmergency: document.getElementById('postEmergency').value === 'true',
                tags: document.getElementById('postTags').value.split(',').map(t => t.trim()),
                likes: parseInt(document.getElementById('postLikes').value)
            };
            
            const id = document.getElementById('postId').value;
            
            try {
                const response = await fetch(`${API_BASE}/api/forum?id=${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(postData)
                });
                
                if (response.ok) {
                    alert('更新成功！');
                    closeModal();
                    loadPosts();
                } else {
                    alert('更新失败！');
                }
            } catch (error) {
                alert('操作失败：' + error.message);
            }
        }

        // 删除帖子
        async function deletePost(id) {
            if (!confirm('确定要删除这个帖子吗？')) return;
            
            try {
                const response = await fetch(`${API_BASE}/api/forum?id=${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('删除成功！');
                    loadPosts();
                } else {
                    alert('删除失败！');
                }
            } catch (error) {
                alert('操作失败：' + error.message);
            }
        }

        // 显示添加档案模态框
        function showAddProfileModal() {
            document.getElementById('modalTitle').textContent = '添加新档案';
            document.getElementById('modalBody').innerHTML = `
                <div class="form-group">
                    <label>名字</label>
                    <input type="text" id="profileName" placeholder="输入动物名字">
                </div>
                <div class="form-group">
                    <label>类型</label>
                    <select id="profileType">
                        <option value="猫">猫</option>
                        <option value="狗">狗</option>
                        <option value="其他">其他</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>品种</label>
                    <input type="text" id="profileBreed" placeholder="输入品种">
                </div>
                <div class="form-group">
                    <label>性别</label>
                    <select id="profileGender">
                        <option value="公">公</option>
                        <option value="母">母</option>
                        <option value="未知">未知</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>救助日期</label>
                    <input type="date" id="profileRescueDate">
                </div>
                <div class="form-group">
                    <label>救助地点</label>
                    <input type="text" id="profileRescueLocation" placeholder="输入救助地点">
                </div>
                <div class="form-group">
                    <label>当前状态</label>
                    <select id="profileStatus">
                        <option value="等待领养">等待领养</option>
                        <option value="医疗中">医疗中</option>
                        <option value="已领养">已领养</option>
                    </select>
                </div>
                <button class="btn btn-success" onclick="saveProfile()">保存</button>
            `;
            document.getElementById('modal').classList.add('active');
        }

        // 编辑档案
        function editProfile(profile) {
            document.getElementById('modalTitle').textContent = '编辑档案';
            document.getElementById('modalBody').innerHTML = `
                <div class="form-group">
                    <label>ID</label>
                    <input type="text" id="profileId" value="${profile.id}" readonly>
                </div>
                <div class="form-group">
                    <label>名字</label>
                    <input type="text" id="profileName" value="${profile.name}">
                </div>
                <div class="form-group">
                    <label>类型</label>
                    <select id="profileType">
                        <option value="猫" ${profile.type === '猫' ? 'selected' : ''}>猫</option>
                        <option value="狗" ${profile.type === '狗' ? 'selected' : ''}>狗</option>
                        <option value="其他" ${profile.type === '其他' ? 'selected' : ''}>其他</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>品种</label>
                    <input type="text" id="profileBreed" value="${profile.breed}">
                </div>
                <div class="form-group">
                    <label>性别</label>
                    <select id="profileGender">
                        <option value="公" ${profile.gender === '公' ? 'selected' : ''}>公</option>
                        <option value="母" ${profile.gender === '母' ? 'selected' : ''}>母</option>
                        <option value="未知" ${profile.gender === '未知' ? 'selected' : ''}>未知</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>救助日期</label>
                    <input type="date" id="profileRescueDate" value="${profile.rescueDate}">
                </div>
                <div class="form-group">
                    <label>救助地点</label>
                    <input type="text" id="profileRescueLocation" value="${profile.rescueLocation}">
                </div>
                <div class="form-group">
                    <label>当前状态</label>
                    <select id="profileStatus">
                        <option value="等待领养" ${profile.currentStatus === '等待领养' ? 'selected' : ''}>等待领养</option>
                        <option value="医疗中" ${profile.currentStatus === '医疗中' ? 'selected' : ''}>医疗中</option>
                        <option value="已领养" ${profile.currentStatus === '已领养' ? 'selected' : ''}>已领养</option>
                    </select>
                </div>
                <button class="btn btn-success" onclick="updateProfile()">更新</button>
            `;
            document.getElementById('modal').classList.add('active');
        }

        // 保存档案
        async function saveProfile() {
            const profileData = {
                name: document.getElementById('profileName').value,
                type: document.getElementById('profileType').value,
                breed: document.getElementById('profileBreed').value,
                gender: document.getElementById('profileGender').value,
                rescueDate: document.getElementById('profileRescueDate').value,
                rescueLocation: document.getElementById('profileRescueLocation').value,
                currentStatus: document.getElementById('profileStatus').value
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/profiles`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(profileData)
                });
                
                if (response.ok) {
                    alert('添加成功！');
                    closeModal();
                    loadProfiles();
                } else {
                    alert('添加失败！');
                }
            } catch (error) {
                alert('操作失败：' + error.message);
            }
        }

        // 更新档案
        async function updateProfile() {
            const profileData = {
                name: document.getElementById('profileName').value,
                type: document.getElementById('profileType').value,
                breed: document.getElementById('profileBreed').value,
                gender: document.getElementById('profileGender').value,
                rescueDate: document.getElementById('profileRescueDate').value,
                rescueLocation: document.getElementById('profileRescueLocation').value,
                currentStatus: document.getElementById('profileStatus').value
            };
            
            const id = document.getElementById('profileId').value;
            
            try {
                const response = await fetch(`${API_BASE}/api/profiles?id=${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(profileData)
                });
                
                if (response.ok) {
                    alert('更新成功！');
                    closeModal();
                    loadProfiles();
                } else {
                    alert('更新失败！');
                }
            } catch (error) {
                alert('操作失败：' + error.message);
            }
        }

        // 删除档案
        async function deleteProfile(id) {
            if (!confirm('确定要删除这个档案吗？')) return;
            
            try {
                const response = await fetch(`${API_BASE}/api/profiles?id=${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('删除成功！');
                    loadProfiles();
                } else {
                    alert('删除失败！');
                }
            } catch (error) {
                alert('操作失败：' + error.message);
            }
        }

        // 导出数据
        async function exportData() {
            try {
                const [postsRes, profilesRes] = await Promise.all([
                    fetch(`${API_BASE}/api/forum?limit=1000`),
                    fetch(`${API_BASE}/api/profiles?limit=1000`)
                ]);
                
                const postsData = await postsRes.json();
                const profilesData = await profilesRes.json();
                
                const exportData = {
                    exportTime: new Date().toISOString(),
                    posts: postsData.data?.posts || [],
                    profiles: profilesData.data?.profiles || []
                };
                
                // 显示在预览区
                document.getElementById('dataPreview').textContent = 
                    JSON.stringify(exportData, null, 2);
                
                // 下载JSON文件
                const blob = new Blob([JSON.stringify(exportData, null, 2)], 
                    { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `animal-rescue-data-${Date.now()}.json`;
                a.click();
                
            } catch (error) {
                alert('导出失败：' + error.message);
            }
        }

        // 导入数据
        function importData() {
            const file = document.getElementById('importFile').files[0];
            if (!file) {
                alert('请选择文件');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // 这里需要根据实际的后端API来导入数据
                    alert('导入功能需要后端支持批量导入API');
                    
                    // 显示在预览区
                    document.getElementById('dataPreview').textContent = 
                        JSON.stringify(data, null, 2);
                        
                } catch (error) {
                    alert('导入失败：' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // 测试API
        async function testApi() {
            const endpoint = document.getElementById('apiEndpoint').value;
            const method = document.getElementById('apiMethod').value;
            const params = document.getElementById('apiParams').value;
            
            try {
                const options = {
                    method: method,
                    headers: { 'Content-Type': 'application/json' }
                };
                
                if (method !== 'GET' && params) {
                    options.body = params;
                }
                
                const response = await fetch(`${API_BASE}${endpoint}`, options);
                const data = await response.json();
                
                document.getElementById('apiResponse').textContent = 
                    JSON.stringify(data, null, 2);
                    
                apiCalls++;
                
            } catch (error) {
                document.getElementById('apiResponse').textContent = 
                    '错误：' + error.message;
            }
        }

        // 更新API测试
        function updateApiTest() {
            const endpoint = document.getElementById('apiEndpoint').value;
            
            if (endpoint.includes('location')) {
                document.getElementById('apiMethod').value = 'POST';
                document.getElementById('apiParams').value = 
                    '{\n  "latitude": 31.2304,\n  "longitude": 121.4737\n}';
            } else if (endpoint.includes('upload')) {
                document.getElementById('apiMethod').value = 'POST';
                document.getElementById('apiParams').value = 
                    '{\n  "fileName": "test.jpg",\n  "fileData": "base64_data_here"\n}';
            } else {
                document.getElementById('apiMethod').value = 'GET';
                document.getElementById('apiParams').value = '{}';
            }
        }

        // 关闭模态框
        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }
    </script>
</body>
</html>