<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ¨ç‰©æ•‘åŠ©åç«¯ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #333;
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .api-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: #e8f5e9;
            border-radius: 25px;
            color: #2e7d32;
            font-weight: 600;
        }

        .api-status.offline {
            background: #ffebee;
            color: #c62828;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #4caf50;
            animation: pulse 2s infinite;
        }

        .status-dot.offline {
            background: #f44336;
            animation: none;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(76, 175, 80, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
        }

        .tabs {
            background: white;
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            display: flex;
            gap: 10px;
        }

        .tab-btn {
            padding: 12px 24px;
            border: none;
            background: #f5f5f5;
            color: #666;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            background: #e0e0e0;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .content-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: none;
        }

        .content-card.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 20px;
            border-radius: 10px;
            color: white;
        }

        .stat-card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #666;
            border-bottom: 2px solid #e0e0e0;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            margin-right: 5px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-success {
            background: #4caf50;
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .search-box {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            width: 300px;
            font-size: 14px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-btn {
            font-size: 28px;
            cursor: pointer;
            color: #999;
            border: none;
            background: none;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .json-viewer {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .tag {
            display: inline-block;
            padding: 4px 8px;
            background: #e3f2fd;
            color: #1976d2;
            border-radius: 4px;
            font-size: 12px;
            margin-right: 4px;
        }

        .tag.emergency {
            background: #ffebee;
            color: #c62828;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .empty-state {
            text-align: center;
            padding: 60px;
            color: #999;
        }

        .empty-state h3 {
            color: #666;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¾ åŠ¨ç‰©æ•‘åŠ©åç«¯ç®¡ç†ç³»ç»Ÿ</h1>
            <div class="api-status" id="apiStatus">
                <span class="status-dot"></span>
                <span>APIæœåŠ¡è¿è¡Œä¸­</span>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('overview')">ğŸ“Š æ€»è§ˆ</button>
            <button class="tab-btn" onclick="switchTab('forum')">ğŸ’¬ è®ºå›ç®¡ç†</button>
            <button class="tab-btn" onclick="switchTab('profiles')">ğŸ“ æ¡£æ¡ˆç®¡ç†</button>
            <button class="tab-btn" onclick="switchTab('data')">ğŸ’¾ æ•°æ®ç®¡ç†</button>
            <button class="tab-btn" onclick="switchTab('api-test')">ğŸ”§ APIæµ‹è¯•</button>
        </div>

        <!-- æ€»è§ˆé¢æ¿ -->
        <div id="overview" class="content-card active">
            <h2>ç³»ç»Ÿæ€»è§ˆ</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>è®ºå›å¸–å­</h3>
                    <div class="value" id="postsCount">0</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                    <h3>åŠ¨ç‰©æ¡£æ¡ˆ</h3>
                    <div class="value" id="profilesCount">0</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);">
                    <h3>ä»Šæ—¥è®¿é—®</h3>
                    <div class="value" id="visitsCount">0</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                    <h3>APIè°ƒç”¨</h3>
                    <div class="value" id="apiCallsCount">0</div>
                </div>
            </div>
            
            <h3>æœ€è¿‘æ´»åŠ¨</h3>
            <div id="recentActivity" class="data-table">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
        </div>

        <!-- è®ºå›ç®¡ç†é¢æ¿ -->
        <div id="forum" class="content-card">
            <div class="action-bar">
                <h2>è®ºå›å¸–å­ç®¡ç†</h2>
                <div>
                    <input type="text" class="search-box" placeholder="æœç´¢å¸–å­..." onkeyup="searchPosts(this.value)">
                    <button class="btn btn-success" onclick="showAddPostModal()">+ æ·»åŠ å¸–å­</button>
                </div>
            </div>
            
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>æ ‡é¢˜</th>
                        <th>ä½œè€…</th>
                        <th>æ ‡ç­¾</th>
                        <th>ç‚¹èµ</th>
                        <th>è¯„è®º</th>
                        <th>æ—¶é—´</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="postsTable">
                    <tr><td colspan="8" class="loading">åŠ è½½ä¸­...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- æ¡£æ¡ˆç®¡ç†é¢æ¿ -->
        <div id="profiles" class="content-card">
            <div class="action-bar">
                <h2>åŠ¨ç‰©æ¡£æ¡ˆç®¡ç†</h2>
                <div>
                    <input type="text" class="search-box" placeholder="æœç´¢æ¡£æ¡ˆ..." onkeyup="searchProfiles(this.value)">
                    <button class="btn btn-success" onclick="showAddProfileModal()">+ æ·»åŠ æ¡£æ¡ˆ</button>
                </div>
            </div>
            
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>åå­—</th>
                        <th>ç±»å‹</th>
                        <th>å“ç§</th>
                        <th>çŠ¶æ€</th>
                        <th>æ•‘åŠ©åœ°ç‚¹</th>
                        <th>æ•‘åŠ©æ—¥æœŸ</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="profilesTable">
                    <tr><td colspan="8" class="loading">åŠ è½½ä¸­...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- æ•°æ®ç®¡ç†é¢æ¿ -->
        <div id="data" class="content-card">
            <h2>æ•°æ®ç®¡ç†</h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                <div>
                    <h3>å¯¼å‡ºæ•°æ®</h3>
                    <p style="color: #666; margin: 10px 0;">å¯¼å‡ºæ‰€æœ‰æ•°æ®ä¸ºJSONæ ¼å¼</p>
                    <button class="btn btn-primary" onclick="exportData()">ğŸ“¥ å¯¼å‡ºæ‰€æœ‰æ•°æ®</button>
                </div>
                
                <div>
                    <h3>å¯¼å…¥æ•°æ®</h3>
                    <p style="color: #666; margin: 10px 0;">ä»JSONæ–‡ä»¶å¯¼å…¥æ•°æ®</p>
                    <input type="file" id="importFile" accept=".json" style="margin-bottom: 10px;">
                    <button class="btn btn-primary" onclick="importData()">ğŸ“¤ å¯¼å…¥æ•°æ®</button>
                </div>
            </div>
            
            <div style="margin-top: 30px;">
                <h3>æ•°æ®é¢„è§ˆ</h3>
                <div id="dataPreview" class="json-viewer">
                    ç‚¹å‡»å¯¼å‡ºæŒ‰é’®æŸ¥çœ‹æ•°æ®
                </div>
            </div>
        </div>

        <!-- APIæµ‹è¯•é¢æ¿ -->
        <div id="api-test" class="content-card">
            <h2>APIæµ‹è¯•å·¥å…·</h2>
            
            <div class="form-group">
                <label>é€‰æ‹©API</label>
                <select id="apiEndpoint" onchange="updateApiTest()">
                    <option value="/api/forum">è®ºå› - GET /api/forum</option>
                    <option value="/api/profiles">æ¡£æ¡ˆ - GET /api/profiles</option>
                    <option value="/api/location">å®šä½ - POST /api/location</option>
                    <option value="/api/upload">ä¸Šä¼  - POST /api/upload</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>è¯·æ±‚æ–¹æ³•</label>
                <select id="apiMethod">
                    <option value="GET">GET</option>
                    <option value="POST">POST</option>
                    <option value="PUT">PUT</option>
                    <option value="DELETE">DELETE</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>è¯·æ±‚å‚æ•° (JSON)</label>
                <textarea id="apiParams" placeholder='{"page": 1, "limit": 10}'>{}</textarea>
            </div>
            
            <button class="btn btn-primary" onclick="testApi()">å‘é€è¯·æ±‚</button>
            
            <div style="margin-top: 20px;">
                <h3>å“åº”ç»“æœ</h3>
                <div id="apiResponse" class="json-viewer">
                    è¿˜æœªå‘é€è¯·æ±‚
                </div>
            </div>
        </div>
    </div>

    <!-- æ¨¡æ€æ¡† -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">ç¼–è¾‘</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody">
                <!-- åŠ¨æ€å†…å®¹ -->
            </div>
        </div>
    </div>

    <script>
        // é…ç½®
        const API_BASE = window.location.origin;
        let currentTab = 'overview';
        let allPosts = [];
        let allProfiles = [];
        let apiCalls = 0;

        // åˆå§‹åŒ–
        window.onload = function() {
            checkApiStatus();
            loadOverview();
            setInterval(checkApiStatus, 30000); // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
        };

        // æ£€æŸ¥APIçŠ¶æ€
        async function checkApiStatus() {
            try {
                const response = await fetch(`${API_BASE}/api/forum`);
                if (response.ok) {
                    document.getElementById('apiStatus').className = 'api-status';
                    document.getElementById('apiStatus').innerHTML = 
                        '<span class="status-dot"></span><span>APIæœåŠ¡è¿è¡Œä¸­</span>';
                }
            } catch (error) {
                document.getElementById('apiStatus').className = 'api-status offline';
                document.getElementById('apiStatus').innerHTML = 
                    '<span class="status-dot offline"></span><span>APIæœåŠ¡ç¦»çº¿</span>';
            }
        }

        // åˆ‡æ¢æ ‡ç­¾
        function switchTab(tab) {
            currentTab = tab;
            
            // æ›´æ–°æ ‡ç­¾æŒ‰é’®
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // æ›´æ–°å†…å®¹
            document.querySelectorAll('.content-card').forEach(card => {
                card.classList.remove('active');
            });
            document.getElementById(tab).classList.add('active');
            
            // åŠ è½½å¯¹åº”æ•°æ®
            switch(tab) {
                case 'overview':
                    loadOverview();
                    break;
                case 'forum':
                    loadPosts();
                    break;
                case 'profiles':
                    loadProfiles();
                    break;
            }
        }

        // åŠ è½½æ€»è§ˆ
        async function loadOverview() {
            try {
                // è·å–è®ºå›å¸–å­æ•°
                const postsRes = await fetch(`${API_BASE}/api/forum`);
                const postsData = await postsRes.json();
                document.getElementById('postsCount').textContent = 
                    postsData.data?.pagination?.total || 0;
                
                // è·å–æ¡£æ¡ˆæ•°
                const profilesRes = await fetch(`${API_BASE}/api/profiles`);
                const profilesData = await profilesRes.json();
                document.getElementById('profilesCount').textContent = 
                    profilesData.data?.pagination?.total || 0;
                
                // æ¨¡æ‹Ÿå…¶ä»–æ•°æ®
                document.getElementById('visitsCount').textContent = 
                    Math.floor(Math.random() * 100 + 50);
                document.getElementById('apiCallsCount').textContent = ++apiCalls;
                
                // æœ€è¿‘æ´»åŠ¨
                const recentHtml = `
                    <table class="data-table">
                        <tr>
                            <td>ğŸ†• æ–°å¢å¸–å­</td>
                            <td>ç´§æ€¥æ•‘åŠ©ï¼å‘ç°å—ä¼¤å°çŒ«</td>
                            <td>åˆšåˆš</td>
                        </tr>
                        <tr>
                            <td>ğŸ“ æ›´æ–°æ¡£æ¡ˆ</td>
                            <td>å°æ©˜ - çŠ¶æ€æ›´æ–°ä¸ºå·²é¢†å…»</td>
                            <td>5åˆ†é’Ÿå‰</td>
                        </tr>
                        <tr>
                            <td>ğŸ‘ ç‚¹èµ</td>
                            <td>ç”¨æˆ·ç‚¹èµäº†"å¯»æ‰¾æ©˜çŒ«ä¸»äºº"</td>
                            <td>10åˆ†é’Ÿå‰</td>
                        </tr>
                    </table>
                `;
                document.getElementById('recentActivity').innerHTML = recentHtml;
                
            } catch (error) {
                console.error('åŠ è½½æ€»è§ˆå¤±è´¥:', error);
            }
        }

        // åŠ è½½è®ºå›å¸–å­
        async function loadPosts() {
            try {
                const response = await fetch(`${API_BASE}/api/forum?limit=100`);
                const data = await response.json();
                allPosts = data.data?.posts || [];
                renderPosts(allPosts);
                apiCalls++;
            } catch (error) {
                console.error('åŠ è½½å¸–å­å¤±è´¥:', error);
                document.getElementById('postsTable').innerHTML = 
                    '<tr><td colspan="8" class="empty-state">åŠ è½½å¤±è´¥</td></tr>';
            }
        }

        // æ¸²æŸ“å¸–å­
        function renderPosts(posts) {
            if (posts.length === 0) {
                document.getElementById('postsTable').innerHTML = 
                    '<tr><td colspan="8" class="empty-state">æš‚æ— æ•°æ®</td></tr>';
                return;
            }
            
            const html = posts.map(post => `
                <tr>
                    <td>${post.id}</td>
                    <td>${post.title}</td>
                    <td>${post.author}</td>
                    <td>
                        ${post.isEmergency ? '<span class="tag emergency">ç´§æ€¥</span>' : ''}
                        ${post.tags?.map(tag => `<span class="tag">${tag}</span>`).join('') || ''}
                    </td>
                    <td>${post.likes}</td>
                    <td>${post.comments}</td>
                    <td>${new Date(post.createTime).toLocaleDateString()}</td>
                    <td>
                        <button class="btn btn-primary" onclick='editPost(${JSON.stringify(post)})'>ç¼–è¾‘</button>
                        <button class="btn btn-danger" onclick="deletePost('${post.id}')">åˆ é™¤</button>
                    </td>
                </tr>
            `).join('');
            
            document.getElementById('postsTable').innerHTML = html;
        }

        // æœç´¢å¸–å­
        function searchPosts(keyword) {
            if (!keyword) {
                renderPosts(allPosts);
                return;
            }
            
            const filtered = allPosts.filter(post => 
                post.title.includes(keyword) || 
                post.content.includes(keyword) ||
                post.author.includes(keyword)
            );
            renderPosts(filtered);
        }

        // åŠ è½½æ¡£æ¡ˆ
        async function loadProfiles() {
            try {
                const response = await fetch(`${API_BASE}/api/profiles?limit=100`);
                const data = await response.json();
                allProfiles = data.data?.profiles || [];
                renderProfiles(allProfiles);
                apiCalls++;
            } catch (error) {
                console.error('åŠ è½½æ¡£æ¡ˆå¤±è´¥:', error);
                document.getElementById('profilesTable').innerHTML = 
                    '<tr><td colspan="8" class="empty-state">åŠ è½½å¤±è´¥</td></tr>';
            }
        }

        // æ¸²æŸ“æ¡£æ¡ˆ
        function renderProfiles(profiles) {
            if (profiles.length === 0) {
                document.getElementById('profilesTable').innerHTML = 
                    '<tr><td colspan="8" class="empty-state">æš‚æ— æ•°æ®</td></tr>';
                return;
            }
            
            const html = profiles.map(profile => `
                <tr>
                    <td>${profile.id}</td>
                    <td>${profile.name}</td>
                    <td>${profile.type}</td>
                    <td>${profile.breed}</td>
                    <td>${profile.currentStatus}</td>
                    <td>${profile.rescueLocation}</td>
                    <td>${profile.rescueDate}</td>
                    <td>
                        <button class="btn btn-primary" onclick='editProfile(${JSON.stringify(profile)})'>ç¼–è¾‘</button>
                        <button class="btn btn-danger" onclick="deleteProfile('${profile.id}')">åˆ é™¤</button>
                    </td>
                </tr>
            `).join('');
            
            document.getElementById('profilesTable').innerHTML = html;
        }

        // æœç´¢æ¡£æ¡ˆ
        function searchProfiles(keyword) {
            if (!keyword) {
                renderProfiles(allProfiles);
                return;
            }
            
            const filtered = allProfiles.filter(profile => 
                profile.name.includes(keyword) || 
                profile.rescueLocation.includes(keyword) ||
                profile.breed.includes(keyword)
            );
            renderProfiles(filtered);
        }

        // æ˜¾ç¤ºæ·»åŠ å¸–å­æ¨¡æ€æ¡†
        function showAddPostModal() {
            document.getElementById('modalTitle').textContent = 'æ·»åŠ æ–°å¸–å­';
            document.getElementById('modalBody').innerHTML = `
                <div class="form-group">
                    <label>æ ‡é¢˜</label>
                    <input type="text" id="postTitle" placeholder="è¾“å…¥å¸–å­æ ‡é¢˜">
                </div>
                <div class="form-group">
                    <label>å†…å®¹</label>
                    <textarea id="postContent" placeholder="è¾“å…¥å¸–å­å†…å®¹"></textarea>
                </div>
                <div class="form-group">
                    <label>ä½œè€…</label>
                    <input type="text" id="postAuthor" placeholder="è¾“å…¥ä½œè€…åç§°">
                </div>
                <div class="form-group">
                    <label>ç´§æ€¥æ•‘åŠ©</label>
                    <select id="postEmergency">
                        <option value="false">å¦</option>
                        <option value="true">æ˜¯</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼‰</label>
                    <input type="text" id="postTags" placeholder="æ•‘åŠ©,çŒ«,ç´§æ€¥">
                </div>
                <button class="btn btn-success" onclick="savePost()">ä¿å­˜</button>
            `;
            document.getElementById('modal').classList.add('active');
        }

        // ç¼–è¾‘å¸–å­
        function editPost(post) {
            document.getElementById('modalTitle').textContent = 'ç¼–è¾‘å¸–å­';
            document.getElementById('modalBody').innerHTML = `
                <div class="form-group">
                    <label>ID</label>
                    <input type="text" id="postId" value="${post.id}" readonly>
                </div>
                <div class="form-group">
                    <label>æ ‡é¢˜</label>
                    <input type="text" id="postTitle" value="${post.title}">
                </div>
                <div class="form-group">
                    <label>å†…å®¹</label>
                    <textarea id="postContent">${post.content}</textarea>
                </div>
                <div class="form-group">
                    <label>ä½œè€…</label>
                    <input type="text" id="postAuthor" value="${post.author}">
                </div>
                <div class="form-group">
                    <label>ç´§æ€¥æ•‘åŠ©</label>
                    <select id="postEmergency">
                        <option value="false" ${!post.isEmergency ? 'selected' : ''}>å¦</option>
                        <option value="true" ${post.isEmergency ? 'selected' : ''}>æ˜¯</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼‰</label>
                    <input type="text" id="postTags" value="${post.tags?.join(',') || ''}">
                </div>
                <div class="form-group">
                    <label>ç‚¹èµæ•°</label>
                    <input type="number" id="postLikes" value="${post.likes}">
                </div>
                <button class="btn btn-success" onclick="updatePost()">æ›´æ–°</button>
            `;
            document.getElementById('modal').classList.add('active');
        }

        // ä¿å­˜å¸–å­
        async function savePost() {
            const postData = {
                title: document.getElementById('postTitle').value,
                content: document.getElementById('postContent').value,
                author: document.getElementById('postAuthor').value,
                isEmergency: document.getElementById('postEmergency').value === 'true',
                tags: document.getElementById('postTags').value.split(',').map(t => t.trim()),
                location: 'ä¸Šæµ·å¸‚'
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/forum`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(postData)
                });
                
                if (response.ok) {
                    alert('æ·»åŠ æˆåŠŸï¼');
                    closeModal();
                    loadPosts();
                } else {
                    alert('æ·»åŠ å¤±è´¥ï¼');
                }
            } catch (error) {
                alert('æ“ä½œå¤±è´¥ï¼š' + error.message);
            }
        }

        // æ›´æ–°å¸–å­
        async function updatePost() {
            const postData = {
                title: document.getElementById('postTitle').value,
                content: document.getElementById('postContent').value,
                author: document.getElementById('postAuthor').value,
                isEmergency: document.getElementById('postEmergency').value === 'true',
                tags: document.getElementById('postTags').value.split(',').map(t => t.trim()),
                likes: parseInt(document.getElementById('postLikes').value)
            };
            
            const id = document.getElementById('postId').value;
            
            try {
                const response = await fetch(`${API_BASE}/api/forum?id=${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(postData)
                });
                
                if (response.ok) {
                    alert('æ›´æ–°æˆåŠŸï¼');
                    closeModal();
                    loadPosts();
                } else {
                    alert('æ›´æ–°å¤±è´¥ï¼');
                }
            } catch (error) {
                alert('æ“ä½œå¤±è´¥ï¼š' + error.message);
            }
        }

        // åˆ é™¤å¸–å­
        async function deletePost(id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¸–å­å—ï¼Ÿ')) return;
            
            try {
                const response = await fetch(`${API_BASE}/api/forum?id=${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('åˆ é™¤æˆåŠŸï¼');
                    loadPosts();
                } else {
                    alert('åˆ é™¤å¤±è´¥ï¼');
                }
            } catch (error) {
                alert('æ“ä½œå¤±è´¥ï¼š' + error.message);
            }
        }

        // æ˜¾ç¤ºæ·»åŠ æ¡£æ¡ˆæ¨¡æ€æ¡†
        function showAddProfileModal() {
            document.getElementById('modalTitle').textContent = 'æ·»åŠ æ–°æ¡£æ¡ˆ';
            document.getElementById('modalBody').innerHTML = `
                <div class="form-group">
                    <label>åå­—</label>
                    <input type="text" id="profileName" placeholder="è¾“å…¥åŠ¨ç‰©åå­—">
                </div>
                <div class="form-group">
                    <label>ç±»å‹</label>
                    <select id="profileType">
                        <option value="çŒ«">çŒ«</option>
                        <option value="ç‹—">ç‹—</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>å“ç§</label>
                    <input type="text" id="profileBreed" placeholder="è¾“å…¥å“ç§">
                </div>
                <div class="form-group">
                    <label>æ€§åˆ«</label>
                    <select id="profileGender">
                        <option value="å…¬">å…¬</option>
                        <option value="æ¯">æ¯</option>
                        <option value="æœªçŸ¥">æœªçŸ¥</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>æ•‘åŠ©æ—¥æœŸ</label>
                    <input type="date" id="profileRescueDate">
                </div>
                <div class="form-group">
                    <label>æ•‘åŠ©åœ°ç‚¹</label>
                    <input type="text" id="profileRescueLocation" placeholder="è¾“å…¥æ•‘åŠ©åœ°ç‚¹">
                </div>
                <div class="form-group">
                    <label>å½“å‰çŠ¶æ€</label>
                    <select id="profileStatus">
                        <option value="ç­‰å¾…é¢†å…»">ç­‰å¾…é¢†å…»</option>
                        <option value="åŒ»ç–—ä¸­">åŒ»ç–—ä¸­</option>
                        <option value="å·²é¢†å…»">å·²é¢†å…»</option>
                    </select>
                </div>
                <button class="btn btn-success" onclick="saveProfile()">ä¿å­˜</button>
            `;
            document.getElementById('modal').classList.add('active');
        }

        // ç¼–è¾‘æ¡£æ¡ˆ
        function editProfile(profile) {
            document.getElementById('modalTitle').textContent = 'ç¼–è¾‘æ¡£æ¡ˆ';
            document.getElementById('modalBody').innerHTML = `
                <div class="form-group">
                    <label>ID</label>
                    <input type="text" id="profileId" value="${profile.id}" readonly>
                </div>
                <div class="form-group">
                    <label>åå­—</label>
                    <input type="text" id="profileName" value="${profile.name}">
                </div>
                <div class="form-group">
                    <label>ç±»å‹</label>
                    <select id="profileType">
                        <option value="çŒ«" ${profile.type === 'çŒ«' ? 'selected' : ''}>çŒ«</option>
                        <option value="ç‹—" ${profile.type === 'ç‹—' ? 'selected' : ''}>ç‹—</option>
                        <option value="å…¶ä»–" ${profile.type === 'å…¶ä»–' ? 'selected' : ''}>å…¶ä»–</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>å“ç§</label>
                    <input type="text" id="profileBreed" value="${profile.breed}">
                </div>
                <div class="form-group">
                    <label>æ€§åˆ«</label>
                    <select id="profileGender">
                        <option value="å…¬" ${profile.gender === 'å…¬' ? 'selected' : ''}>å…¬</option>
                        <option value="æ¯" ${profile.gender === 'æ¯' ? 'selected' : ''}>æ¯</option>
                        <option value="æœªçŸ¥" ${profile.gender === 'æœªçŸ¥' ? 'selected' : ''}>æœªçŸ¥</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>æ•‘åŠ©æ—¥æœŸ</label>
                    <input type="date" id="profileRescueDate" value="${profile.rescueDate}">
                </div>
                <div class="form-group">
                    <label>æ•‘åŠ©åœ°ç‚¹</label>
                    <input type="text" id="profileRescueLocation" value="${profile.rescueLocation}">
                </div>
                <div class="form-group">
                    <label>å½“å‰çŠ¶æ€</label>
                    <select id="profileStatus">
                        <option value="ç­‰å¾…é¢†å…»" ${profile.currentStatus === 'ç­‰å¾…é¢†å…»' ? 'selected' : ''}>ç­‰å¾…é¢†å…»</option>
                        <option value="åŒ»ç–—ä¸­" ${profile.currentStatus === 'åŒ»ç–—ä¸­' ? 'selected' : ''}>åŒ»ç–—ä¸­</option>
                        <option value="å·²é¢†å…»" ${profile.currentStatus === 'å·²é¢†å…»' ? 'selected' : ''}>å·²é¢†å…»</option>
                    </select>
                </div>
                <button class="btn btn-success" onclick="updateProfile()">æ›´æ–°</button>
            `;
            document.getElementById('modal').classList.add('active');
        }

        // ä¿å­˜æ¡£æ¡ˆ
        async function saveProfile() {
            const profileData = {
                name: document.getElementById('profileName').value,
                type: document.getElementById('profileType').value,
                breed: document.getElementById('profileBreed').value,
                gender: document.getElementById('profileGender').value,
                rescueDate: document.getElementById('profileRescueDate').value,
                rescueLocation: document.getElementById('profileRescueLocation').value,
                currentStatus: document.getElementById('profileStatus').value
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/profiles`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(profileData)
                });
                
                if (response.ok) {
                    alert('æ·»åŠ æˆåŠŸï¼');
                    closeModal();
                    loadProfiles();
                } else {
                    alert('æ·»åŠ å¤±è´¥ï¼');
                }
            } catch (error) {
                alert('æ“ä½œå¤±è´¥ï¼š' + error.message);
            }
        }

        // æ›´æ–°æ¡£æ¡ˆ
        async function updateProfile() {
            const profileData = {
                name: document.getElementById('profileName').value,
                type: document.getElementById('profileType').value,
                breed: document.getElementById('profileBreed').value,
                gender: document.getElementById('profileGender').value,
                rescueDate: document.getElementById('profileRescueDate').value,
                rescueLocation: document.getElementById('profileRescueLocation').value,
                currentStatus: document.getElementById('profileStatus').value
            };
            
            const id = document.getElementById('profileId').value;
            
            try {
                const response = await fetch(`${API_BASE}/api/profiles?id=${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(profileData)
                });
                
                if (response.ok) {
                    alert('æ›´æ–°æˆåŠŸï¼');
                    closeModal();
                    loadProfiles();
                } else {
                    alert('æ›´æ–°å¤±è´¥ï¼');
                }
            } catch (error) {
                alert('æ“ä½œå¤±è´¥ï¼š' + error.message);
            }
        }

        // åˆ é™¤æ¡£æ¡ˆ
        async function deleteProfile(id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¡£æ¡ˆå—ï¼Ÿ')) return;
            
            try {
                const response = await fetch(`${API_BASE}/api/profiles?id=${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('åˆ é™¤æˆåŠŸï¼');
                    loadProfiles();
                } else {
                    alert('åˆ é™¤å¤±è´¥ï¼');
                }
            } catch (error) {
                alert('æ“ä½œå¤±è´¥ï¼š' + error.message);
            }
        }

        // å¯¼å‡ºæ•°æ®
        async function exportData() {
            try {
                const [postsRes, profilesRes] = await Promise.all([
                    fetch(`${API_BASE}/api/forum?limit=1000`),
                    fetch(`${API_BASE}/api/profiles?limit=1000`)
                ]);
                
                const postsData = await postsRes.json();
                const profilesData = await profilesRes.json();
                
                const exportData = {
                    exportTime: new Date().toISOString(),
                    posts: postsData.data?.posts || [],
                    profiles: profilesData.data?.profiles || []
                };
                
                // æ˜¾ç¤ºåœ¨é¢„è§ˆåŒº
                document.getElementById('dataPreview').textContent = 
                    JSON.stringify(exportData, null, 2);
                
                // ä¸‹è½½JSONæ–‡ä»¶
                const blob = new Blob([JSON.stringify(exportData, null, 2)], 
                    { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `animal-rescue-data-${Date.now()}.json`;
                a.click();
                
            } catch (error) {
                alert('å¯¼å‡ºå¤±è´¥ï¼š' + error.message);
            }
        }

        // å¯¼å…¥æ•°æ®
        function importData() {
            const file = document.getElementById('importFile').files[0];
            if (!file) {
                alert('è¯·é€‰æ‹©æ–‡ä»¶');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // è¿™é‡Œéœ€è¦æ ¹æ®å®é™…çš„åç«¯APIæ¥å¯¼å…¥æ•°æ®
                    alert('å¯¼å…¥åŠŸèƒ½éœ€è¦åç«¯æ”¯æŒæ‰¹é‡å¯¼å…¥API');
                    
                    // æ˜¾ç¤ºåœ¨é¢„è§ˆåŒº
                    document.getElementById('dataPreview').textContent = 
                        JSON.stringify(data, null, 2);
                        
                } catch (error) {
                    alert('å¯¼å…¥å¤±è´¥ï¼š' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // æµ‹è¯•API
        async function testApi() {
            const endpoint = document.getElementById('apiEndpoint').value;
            const method = document.getElementById('apiMethod').value;
            const params = document.getElementById('apiParams').value;
            
            try {
                const options = {
                    method: method,
                    headers: { 'Content-Type': 'application/json' }
                };
                
                if (method !== 'GET' && params) {
                    options.body = params;
                }
                
                const response = await fetch(`${API_BASE}${endpoint}`, options);
                const data = await response.json();
                
                document.getElementById('apiResponse').textContent = 
                    JSON.stringify(data, null, 2);
                    
                apiCalls++;
                
            } catch (error) {
                document.getElementById('apiResponse').textContent = 
                    'é”™è¯¯ï¼š' + error.message;
            }
        }

        // æ›´æ–°APIæµ‹è¯•
        function updateApiTest() {
            const endpoint = document.getElementById('apiEndpoint').value;
            
            if (endpoint.includes('location')) {
                document.getElementById('apiMethod').value = 'POST';
                document.getElementById('apiParams').value = 
                    '{\n  "latitude": 31.2304,\n  "longitude": 121.4737\n}';
            } else if (endpoint.includes('upload')) {
                document.getElementById('apiMethod').value = 'POST';
                document.getElementById('apiParams').value = 
                    '{\n  "fileName": "test.jpg",\n  "fileData": "base64_data_here"\n}';
            } else {
                document.getElementById('apiMethod').value = 'GET';
                document.getElementById('apiParams').value = '{}';
            }
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }
    </script>
</body>
</html>